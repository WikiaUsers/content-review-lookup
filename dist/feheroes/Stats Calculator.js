mw.hook('wikipage.content').add(function() {
	'use strict';
	var main = document.getElementById('stat-calculator-loading');
	if (!main) return;
	var growthVectors = [
		[1048576,8388608,8388608,1073741824,524288,256,1048576,1073741824,1,134217728,1048576,536870912,64,274877906944,536870912,8589934592,274877906944,137438953472,4,1024,64,68719476736,8388608,2097152,33554432,32,8,524288,1073741824,8,4194304,256,67108864,65536,256,65536,524288,536870912,262144,2,137438953472,32768,8,2,256,16777216,2147483648,1073741824,268435456,8192,4194304,4,1073741824,274877906944,2097152,1,8589934592,4,274877906944,16,2147483648,8,16384,8192],
		[294912,33554433,100663296,768,274882101248,540672,137438953984,68719607808,6291456,4194432,67584,262145,67633152,536870920,10240,274877923328,33558528,5368709120,275951648768,9437184,8388609,1073742336,2112,528384,2147483649,541065216,277025390592,137447342080,4160,536879104,83886080,147456,2097184,274877907968,393216,8256,138412032,32772,262160,134217729,34359740416,268435968,2147483656,73728,274877906946,1048704,137438961664,134225920,1074790400,10485760,3072,4294967328,4259840,4294967304,4352,2097184,2147483664,67371008,33280,34359738880,1073741888,137439477760,1048608,65600],
		[17180000512,8623489280,4294967368,8454148,34944,4429201408,553652224,68853702656,134217776,1065024,37748737,393344,2214592528,67178496,2097284,167903232,292,33816578,146028888072,33556608,34360262658,139586437136,537395208,274946064384,274878431240,268468228,1074792448,2105376,8589938692,2181070848,5368709121,51539608064,68719476996,69793480704,343597416448,131600,6442450960,38656802816,68720009216,409600,42949804032,8610906112,66064,268501024,1056784,1077936144,536875520,16514,67117184,1179904,537002496,402653188,275012124676,1073807424,25198592,34896609312,1081352,4294967560,131840,206191984640,70866960512,73014444048,2621448,137439608832],
		[6442582032,134285376,8661238272,71941226496,201344000,572522752,68719808512,12713986,68727867904,1083179012,68987916320,6452936704,68786585860,4429709314,103349747712,35567706112,25769812480,35433480712,571736064,163208758272,275481919488,68719501568,1107312896,1077937153,69264736384,2156134656,8594129160,17049600,659457,283736276993,1619001600,83976,8592031750,688390144,138521608192,132116,69256351745,68719607904,17188274688,67403904,34359869968,8599437312,275951656962,8589959170,12600320,16777286,283467842568,274877909312,279173414912,664,805339140,1572912,21475360800,68987912321,8757706768,73748,1049665,37818368,4206608,9088,139288,2359316,16777241,6442483744],
		[68719706128,68719738950,68755456000,274896781321,17200841217,21509439616,309506088964,2415919216,8590989376,17180655681,36507226272,68920819776,139590639624,17213423690,17918066752,139587551488,34362621954,67895299,605290624,1216349186,309539700736,111803629568,17716742464,9664758016,274877913097,18875409,4320395266,17448312872,540024864,1141383169,16782372,140123316480,35441872912,55834576000,275484016640,377973899272,8628209664,137976381696,28053602304,9160364034,537399840,2622272,4326920,274884198672,275021565952,19335744000,137606791680,51552223232,84934944,301184614400,275951697924,8707391488,2751987744,10738470916,537413634,209715280,171865806848,4296024208,69055029376,176094183936,309238054912,541622784,283485143048,140124356624],
		[83886095,4580212804,156783083650,620773396,309556445184,137707913864,18459656192,274886394376,805668864,1141113424,9177399304,94491639872,272457,18257838212,354888450048,344671658496,143881936898,188989177856,56371445769,143378087968,704913409,4429191240,103348191264,35435577792,840990722,279193854080,19881001040,274929287202,279206428962,70066372609,77317874688,85907735064,34378679040,68719544376,17184108608,51589972032,34630534148,35584739328,280263401480,2197884932,73014444806,139612652544,2701400064,8675262464,9126805527,39059480,417719124992,42949685266,35433571328,68720132704,4308074516,3687456,4768272,34361360448,146298372101,1210066960,86201368704,68788683788,69164072968,283470201857,4831887873,25769806000,68729995281,137448062992],
		[8592216068,34359826696,273187075,69357539392,50594594,19868573696,4582294529,537673880,137707393816,43553784896,69796392960,35438821888,4378642,70071123970,34496223232,284105375792,2283876416,103284788,880820229,34646026,17793384448,292110205024,274914607696,274882300064,272892024,1209305152,275498668104,52630914048,413659070980,17247654912,70330106380,274884462640,2426699808,47295119360,302216,94757721216,1610713106,539002905,1079575808,80531767296,1325314,21609201667,19596838936,292594851844,8724485248,37111214084,2165116944,9128443944,2285389824,2148795489,587465793,68724727905,8859435680,68720665105,34494288900,415035293712,8659141720,68744691748,26055017540,77446283272,274894751796,313532679188,10745808137,3758170148],
		[907551744,25954427008,69264818945,81742798872,159056723984,30668756993,36104575233,274882458624,296355381761,51640860801,38657927296,4296029281,273424434,287762809961,2415924547,17196738572,344710972424,717496448,638584963,382269128713,163309422852,17465091368,113967628576,4376840192,34905146628,1109559305,4448985088,12597396,277159878936,343597396656,73016017955,35467231874,21978165248,34766643216,4374663196,481057341956,10809001216,843186468,286756242688,8592577344,46507229184,172345524229,138529748032,141750720608,274880087075,277026310150,104689965088,33638880,4297132185,154761432256,70869647684,78416711945,6710911536,7786861568,10033332288,343664632323,855638820,140664406800,12936808464,292095590917,18791082496,26039299073,78383219393,277063207169],
		[61272503296,6478115920,288878496776,26382307586,274953799792,412317395506,9160622915,1076496003,137439119573,26474492160,174092984354,276222839812,21779513356,34907391264,138516895941,208389933584,280347291668,16118980864,412323285192,8860598389,10739518401,4371644446,277109287045,17985177941,171802921493,69395874088,5104475520,71706116099,277026480740,173981057057,1174432833,283469983968,43823300864,347892386378,4502594120,104155127833,46246666242,77376868361,52116619265,34972308736,69810009144,18299879512,68719682187,142982774848,344704689025,284084406306,276098719756,2219852361,5405966720,276002013462,362387890696,29507673,4371252268,1279271266,343603824129,107124629504,19362349345,297426512900,13186957590,10895754304,283502002258,2185266954,343606563120,292250714140],
		[279491677220,60180010248,139989227144,379047946244,184685707403,175559413800,180455769420,70884008043,191403394624,416880345986,42734731,148721803332,38672310852,139672453198,47892692993,181464996097,215152138752,277331575182,87208006720,45131373064,71538196503,241663476001,677431041,38742929696,35434063897,2743218752,4329803873,51544983096,293134082066,10742157489,32010993684,292208797746,17251229928,180393118352,223389179969,19373871104,430044090442,377957258804,226291131424,277562547840,55986145282,3241238546,36511433331,105385299968,137485623326,47848760512,174021805070,283571137792,173813063680,275419064852,346820203072,343667742724,286710173960,171941333530,71240796176,146507382848,378234282120,138393294848,68771125267,6548427392,345078629632,116547256576,86084497412,212819582976],
		[109010026538,4506583152,274890233929,75905400844,10891076880,279244206103,382303145988,138836264976,193432936496,3223391146,834941152,412875507792,11880202246,276222253699,311427142945,78324449378,295351648268,345748059008,159050124000,38756102664,292137619656,44867552320,301738333189,313639175170,500701397121,1176778801,493994770948,341472384,30099916844,3526099300,75178975767,17181211281,246105114640,414078505288,11844783536,6784565896,9378551936,141862134016,17518133644,4541383182,110499361,277160309952,313558974981,156841831560,9664211406,432450048656,347916607748,148178143426,296671516833,13740704280,139863282332,73554725288,831930900,714147941,51692831625,93754262528,9397650128,225813016576,206632911080,277818392584,189326901376,13220578906,173241548906,150435545346],
		[180702347524,72013580176,140124523606,277079609472,30071931216,146365026492,70919979249,4944048396,95567254828,86790148136,36949066052,274890820970,8326287500,69005250671,34456484736,86485894656,378720756232,284820275288,208524289601,75172483985,138531602208,502553248418,69560698482,138131288211,464595156994,37631821085,219169752068,333407453345,234285502497,208379500552,344671707783,26945391372,279776861971,251262013634,71090513921,145769891084,276535313446,447394283521,110666875395,51819782352,295279684368,17291809045,430922940490,468219790339,345949504524,416906494537,442928562192,10756146752,26886049934,80202563594,276924859089,223548179717,123489960016,45673888320,323063128594,32213581088,4499188758,412653176898,141876265377,32225903520,122420201812,507897758736,2260752430,139625104232],
		[85914320416,207166374794,3008565584,76437199944,348035494117,46037477476,275722406157,175031011969,120796006328,46205504426,9714294465,321053792016,23021492300,208776016420,407573722,464940860016,9964130435,104474476938,19547965509,30409590920,277456488524,294540907857,405925005827,277834045462,167320223825,473256085512,111988443370,51555009628,297441973249,370475082380,69837855814,378135483152,177170146464,148503267336,326422189828,145521543744,320265053185,108495504900,16242477274,45710086700,150055483401,473252134947,146379403521,10108288133,274883762538,120538517568,3028391109,2968262669,247900932144,429544737028,64542605544,316300878473,194625143823,285414147125,455820870036,55904969262,94154795265,103962715400,1552583784,422265976864,26366550149,155323799724,533117175120,15582891093],
		[344760334403,129487210541,378014343722,52119094200,267923822625,433054312968,47832009751,44689261666,176657970312,28601491921,304142133952,442392249103,347259116048,423059600647,4733594280,335549604521,146516741212,326431552523,72058969156,189582733590,45668230420,318101392942,431311037001,34955441361,107649082025,67117320806,279850545368,70574950948,74631522375,69056939429,249679897744,293195047240,88636406832,26058567834,190104093836,113023190561,1144894513,143076391601,396212873517,47401039968,286832208278,34940663282,105565553545,137934569817,14156170002,87354923044,177712687315,365213812899,142414858833,179519357721,210059767876,188511232768,70353439457,139160278052,294211768463,53053832464,174501179497,283891539376,60679181904,456680133136,421260509364,43789943924,155529070108,297035891770],
		[34609468431,206318306613,1751030857,206262982796,25986112304,347991977098,413768762216,206706248139,96678757967,112887338061,4418219209,142124129331,166034675913,398433800730,282227563536,314355368433,430486769745,13727793508,448887804296,6317148014,191512139816,132272693511,483792725137,86604931367,426309638201,20544844845,369477552585,166330918948,1332308292,87345359914,8965731385,51637594264,438292332765,10253601835,380431942768,335028110722,17205547911,343607079097,520640071428,464951192044,221296231152,284413332739,275526793761,74501775404,431182946649,116530516028,344848099477,515472183900,364736708973,20942973841,53137928768,22510944417,258386177426,159787176978,217464216193,354473756470,363073835114,521858621478,26678538267,193728398338,418258502822,138886060473,189734917456,148210813366],
		[147138534937,15890683158,388217484328,80434717922,458086543384,416651390244,383342721890,444143399108,518466857032,396628069708,279777459689,352487401666,352730748751,89763979650,468293111821,294359506467,421853405862,151005446591,318714331218,32909951690,478571663425,365320358936,227653661458,149022876298,71042181459,251743318282,315785963010,149885617685,48605900680,324414382312,461913031939,144966936100,336510198480,69574264290,370526363781,159757646488,493788205240,431497494636,74731053357,516014912584,503938621521,31772513812,445166960805,88551491975,99898102204,87980594217,357914674404,345030053088,413425319856,384416570596,3494299999,277934196807,386559383758,79356775815,157887566422,54310066723,187004696656,88467540075,79634564403,496347408387,70352845409,232507744713,7797794728,493183607961],
		[51703547822,66930561040,484233499905,28117057655,111949064997,89423231459,329563253805,399584120612,223656053682,381651517799,491053492803,472729002557,369502131643,141917643461,55045282210,471779123238,73093523150,239096365958,176348010805,379673175203,422989344300,26396652586,473279499818,345667995916,138555187063,156070504088,324301229155,14572407245,138098428137,468576477317,138703721231,31177077366,493454508579,358869456137,95447111976,73560734922,329860122466,461927226274,151119048800,329320469904,475490552096,116790927174,177688550427,109793340601,282546637990,283882809396,103980014358,23791512397,129186355484,263470647886,418971013317,70053871870,300262125940,231399921602,506813761965,243471137265,315934013961,352833950805,288929042322,151587866817,233341746536,405343179093,10414967830,320646603752],
		[42669937088,532940902161,135530381334,292914063771,368176687430,80724428895,44352457169,299411931922,169242547844,421165226003,347795556643,304708109531,211498406099,57389831938,277881678708,455587356807,204079068808,392302449173,115486296533,207326226386,142166905452,285195065634,276459641611,160362832082,236563756992,5833037744,352805632139,153055801437,272487356768,28228041555,326502961719,125849129318,101454011416,156412117391,116440788244,353193574608,503875176817,45797810807,125120309679,70141290402,302179890465,28404738386,47815719471,433284548017,342294192450,4826652072,429928969357,445381288708,276214043973,300663334881,428677235844,401713951221,381793657605,138433584977,485877371897,337578850514,463950474269,96941996601,395743475569,346356281717,114780611154,453767217837,261010548258,270897620424],
		[118313559167,149828507194,476937013443,84951495067,293956852700,118213228307,508033113995,236627633965,437090727590,195036136221,293921924908,430062700510,227386670177,61795106224,104293938169,394727039656,435163940769,537087011425,495861993477,240753814958,57682291369,373140180625,499190874559,325054451885,347179701082,20190246995,469844467789,232999101964,336208111557,303960017049,269347746371,1958602409,429112148523,146360204308,441716011665,281954450947,252377580795,263104083792,439120573533,58166043842,506491658360,337837458718,355851355377,227780307319,194250585473,430927066105,296157003600,4429088831,58079915697,337945432838,440780779091,389122956892,451448006988,100495980807,158921227006,351575038509,476842217293,365559673129,429269979418,301808049014,520572306409,11471090984,423405567820,208185615247],
		[540120319937,385568941420,406713391577,360062966368,442275291417,14649759230,198204654487,539767817988,340732429913,50253454355,366028198553,155806840184,116680756689,125741791600,116999341223,318732882006,62939279814,520050543786,178347490490,423752145781,212120490960,396885900046,302542582396,497009195352,181995228235,150237239076,100086886337,51385004613,63382381047,406086832033,492913564582,259296803852,151077204127,32939383224,2279200726,222960129217,61093549718,156348555224,267989080673,43460085623,378188683212,506389149733,53109088135,91943170906,517966476627,21365435484,246260001929,50459077142,285949980798,358979298250,372050764357,273646385162,350432057178,511162657838,448710706491,101494810258,238746198295,305983319139,415081033341,179347873360,59763455113,504320754092,195168892100,524090460793],
		[241555624572,306406264617,502539446479,170459495779,305312262077,428681030996,223766734719,338327472819,523218219621,533487997523,360509140845,480525601100,58105754653,309685639998,171619959708,485182851463,355792511449,218434493632,369830852980,161035502808,426336414959,396682175230,99835327960,526128158721,76699573913,68205611699,329556511718,385594865810,339200972972,304917754166,139531505396,345569677085,469174651058,328908786030,271720075343,454750509966,259664849564,216592627616,70837579052,263476962676,390604264391,495190019935,225416608169,504906340980,380525012470,44747611067,141521645516,50858221903,507119564442,348478690263,516490476397,302734325424,497463494599,386347540575,48027749803,243660694126,245137895645,435858430096,283854974847,239337504401,224599325430,408569409119,251892288936,264439974286],
		[424876428827,62801550585,480286262837,239044760303,252498072527,485212257120,341682059309,29986362717,188565358290,545232135207,199022137306,401902858988,523226156838,531050179802,62081833916,130704940880,252188897163,244699853578,538639111787,230077228695,509281425852,130248785481,428208156189,516957886901,259203328683,308522382385,302655249779,88975535028,233771094406,264463881167,21718028139,244166079829,53065241549,266772757225,537428343901,291418643873,221655071112,269116353402,356672575226,67093833622,76792591615,94252741229,184410073546,445680282857,437996818153,215473188833,438615534174,283379166734,376647621833,529379722937,370694848093,181947454351,117409783534,236036875158,134372780597,319671725176,319316030670,534741777978,85361701994,179419607674,437964419910,328530069915,61327433716,533503642383],
		[270227856224,77296266821,353777811270,264960121325,478146138588,440736265036,394967846256,171726344115,342248186973,481964583831,518203321307,457503591903,221924390669,489575492686,352954347933,330979602646,348863318429,364967234413,495865084498,86429269873,130970785380,127464165839,471225632229,524446577075,170492026716,265442760038,90671741883,437735141118,321007688183,145326849907,68561617311,55016406187,543976156875,458445085094,483164476278,272796433682,495247481691,231303171896,469937506027,143328231387,372408417254,462321995695,263988102888,524388074451,303561666385,295796724600,266794113519,115422742733,357235086459,184271306536,50195278514,522987189647,372286106390,524908613985,291599740095,535353864085,47776787510,468342756093,160889243566,308691282160,359463271909,323051925307,36422266766,63298331876],
		[436898756596,203712052937,516850964942,478454017501,304649034803,474503216604,491766820309,365069171283,525727812557,200426372789,365907402667,407359057376,94169102813,324914903843,377833178971,457949132770,355866988510,482359112911,102897907644,135877162207,482743795671,168754658031,203931014844,101801474966,211117374431,463288128282,196481780695,477201407286,127620605534,528756880207,254587810671,428269318590,150253006070,509580328347,204948649806,532495059484,390420405590,429396877054,390067830677,230559830953,492693874022,260380827622,35959527421,392979473100,183116691439,339190562546,272375700117,450685443047,272101861245,170854685799,353730453887,459220670060,273680563381,196799426543,502356728990,503746118911,384163079863,44019707735,542236578363,354043165525,468946450899,459539327345,334868358602,509692800477],
		[402703177175,273520610167,484860227246,169365515899,171636911030,451959314317,472174264573,170447630167,311354441343,256529389011,150293428973,226013715891,298925946237,488664268031,467608903379,385201687802,269331198199,359558635384,514829628525,525504160703,523285419768,544089924575,549342999672,379433415143,390835042062,525526725437,546032238585,538564880729,334260791055,520798166653,128661287742,202986585847,162650812400,531254467699,479445638043,255742402405,459379702142,201374752651,541067789245,514173871094,509808203143,523827116920,85710554622,308144883358,269324205485,521298890524,244003447803,116331970291,521762201413,303725147949,162075196412,307336527485,286600977658,255399067306,238235579334,493849880206,222564809199,512522370922,238232006933,500353047379,514499519711,519680179471,343340670894,536576446157],
		[132938063286,441440139005,72783740923,446667003165,85893001679,513678965595,335000157165,527139808986,463215939519,230579895159,529618668254,540811418840,495522778618,343577121455,200783387961,341903142903,343424086845,137385876967,405839411672,426995731453,133127101392,199693557738,257537513429,136778340277,343290765139,390769123219,273249295196,411841699754,316883074550,472188419557,549567775614,472436516790,540956286575,456155328471,498211963570,377347881189,53674228983,256042844120,480055359407,130706832809,136494138351,51259176447,377896151671,540052189899,527590354890,480767003564,428255145417,126553519967,380634890094,496024395718,393184539983,514281502198,90191691398,59189979579,66965843961,67367589118,299166070268,387469112303,201648987613,257016948190,411239782750,462633279102,126265316157,461655668215],
		[269102282127,543850052653,496965516079,235747110815,376857680601,125543364539,95361687292,534351933951,270379361019,480428850589,379970103999,359499824982,188401055677,519388964221,549046646547,508950115321,403273797437,390686307741,111433670525,548142762555,514204236265,265964649966,347621122045,549736743549,541124152317,515126126568,199681569771,478307712731,274688540431,469711289975,412223174613,545048386039,506536348519,261513796415,504625085768,527554772470,523967258515,203463523207,403655249660,343592092657,266230033787,395606089591,532380835187,399127575275,271915414351,471771573599,246137454287,411846783295,197399113559,257666428031,478838482757,544890279951,463645537711,274289888958,377635208884,496013925095,477795039994,453990735799,403688373901,474317978471,237774663675,368140213998,544184269215,133106989631],
		[549611849399,343326080759,63337872383,519416749567,274657550013,527064623229,308087815155,544749780694,540054232697,248966020477,236080582427,94371624959,236167806967,136062168414,513213005039,546242273247,271555845086,510479825967,263469250413,266824055661,543445924799,182523100671,394755227511,428368327663,143846244349,529346985662,412228768158,269233421166,231768850384,408407588843,390674085279,534720749015,535926007791,547453525493,439663614911,375706540023,480972849051,402367651791,541007248318,133927137151,334969601766,270562424824,136096771237,546500833217,406272555903,549445111757,42815437754,268368083762,514313918360,392854728617,510815102457,510543232689,200722558199,536667054069,500354907051,272962616285,549126360039,478869661686,398458873339,515325419123,525791644670,410159643053,252631170941,537942535068],
		[511077957550,171719966591,542404507647,489558308795,539814133209,268234108395,416477346683,399196651503,496024682329,326349240318,204007794299,120133254589,542204992494,528800796651,528279651007,231883620350,266286284792,545305646795,100730273709,376060763775,392988638654,183844470735,480480489197,531492304765,478866800476,133124848247,407413649213,474899546111,508949224947,51405356470,545996106235,512961278333,532487828969,397145980639,257160566206,495993138941,188965912151,272728063530,463168338411,442222113775,469694783475,343529880546,117297799167,458219320782,409959317470,386530012090,152454413303,446638536567,549653567161,393996115790,547274850207,540469458813,239859399675,111500853206,402633121527,536870080414,94216191983,548511055843,135282456055,534705495549,548664601437,386399170431,516863819646,480463207420],
		[510354517439,455263370997,233487990779,394590519135,111131197406,510564088655,416611753963,377885163431,445837078271,546525871422,401372839933,236222666109,549721203434,548608646071,472287010491,545191468535,529081859583,515373768439,478687113199,509891012605,548895649787,412283131311,513623850879,544357742317,515114776542,530402243511,542170405815,542767963503,531132710767,549181042583,274699631327,270530902911,513227618525,502326623737,523980752127,481026768360,478852921791,472428387327,544286408643,547496886265,547291127775,549753282482,549685329527,541030067067,250156679164,545421844207,539770220415,412047010814,412144885221,103054039931,317710106619,543580618590,257126546395,455264157471,549342510717,263972698751,470163980191,240517995894,369366032247,240478301631,390824705529,528143478718,549615433213,263059890175],
		[446625152983,376866462463,205319502843,548949409391,545450293195,532433066719,525596609519,541161605114,547551633279,548673598319,274742566873,266211912703,257691719671,508869441535,549753567847,407484955095,270314434297,549617368359,237825416183,411911823357,549202095986,547455754079,532432804851,548677860476,536866647359,542104854271,98581872623,429428571607,308078968830,549081966079,541090346223,540746169853,504654392318,549314621431,543145000887,257559621107,532559155447,411174420473,274810387707,130970811391,548679923641,549663274855,493883455423,369299945975,340371963103,171794193919,263872053157,391907245819,523818137595,238907553147,522909970429,506671659645,540355264439,341445607357,273736007604,446005501916,476472399583,510962548191,395052834686,543237848795,374928834047,274667795967,186831073111,479685754686],
		[274609397211,542776417790,408017681839,468146675711,270571404767,532571598703,446138543999,549722157822,541162733171,532566892533,399431954263,549553405884,401444950015,409900804079,272696736253,542776442495,411777792959,412249700317,543044925401,259810918397,274816827389,511075938279,412249415669,511083736063,540528205819,549744261083,540947773950,544386962175,539819507175,501965780991,539016264183,532508245469,403173013495,409091440541,309178925047,515391777279,480734019571,476439347179,272654400447,343023810559,540612204539,543296551803,498170068447,409896613885,506638352350,446659772375,411981116415,515362422615,412010665981,274340378351,462648491935,530159975407,411774742491,273636384727,474593881021,532440858615,463801679359,548671323867,514588377023,540628443111,549735812863,272726216189,274051629045,528012015355],
		[549209960383,549202153375,274340577271,411779857787,549751584753,411234430975,273535687679,549721726423,542775443407,549737201343,528003889151,274876989406,541127604095,412048097259,532307244029,549746857855,340904607743,549470600627,543313027055,407995677695,549482653439,545460244477,515244556023,274877046527,549755288779,272193531902,480901513151,549732614103,549712682495,481034756047,515341484023,548916944886,506789351391,549596425087,515396070378,548662116347,498146734079,206157901679,511091605375,549465350142,547603349498,266287953375,273787379451,549352619871,475935522815,532038794207,545444069304,549218859002,547564257151,515394633214,548413536223,411914193919,541090250235,510295408639,545460770797,538984742895,515127639355,548673675166,273802063838,540607774718,197567971317,547574085631,481036171519,549734835963],
		[544378707711,549151637439,528276258813,544890159095,532575927675,540092137326,547599809527,548409442298,471875911679,377957121781,270580776831,515386636159,549734776559,549753159613,412249748863,549487374300,532573585373,480969228273,547532814335,549705482187,549713868787,274843828175,480767376375,549612928895,528012540415,532565327869,497142398971,549409775615,274340773623,547323109371,411914207159,532567424989,206158297083,476706504703,545444003319,532567490367,549738954622,515396073854,409095634807,549462138879,510564204031,549620547261,137438883583,523849695215,133143969790,377420169215,480734314463,541006495741,549713706495,543112028159,515127637982,515390308287,549754486766,411243110015,463787229183,412316204415,549617395199,412048391919,548413634302,532559036397,512845936639,274475253753,549554319359,549621391351],
		[548950244351,515396071103,412316790779,548665291775,273669947375,532575943547,548677877495,476732948479,548673681406,515328827391,549638307839,548679450621,549751454719,274743688943,549750438911,270511636479,549485281273,412300083151,481036254719,549688680446,549755681774,476707815407,545460846383,545460713467,549486329342,547004219391,547608305655,541029564413,515261855727,506801815551,549743230459,547541220735,480667238399,270314500095,530361348095,549753712510,548010967039,547071328251,544923975166,549675073535,541164830461,481034239927,274876850047,515387555807,504658132991,549197905919,545450098687,239947743231,270313979903,541164503039,549201625087,408021893109,548950498815,266153689087,546534555639,549487181807,412308455295,549487368959,549655015423,549734823935,547541212159,532542373855,541165871097,547608328031],
		[548682062847,476741369727,481036337117,549746900927,463856465919,515395550719,545460838383,412316856063,498215944191,549753651183,549621596091,549218942942,549755809751,476741369853,274877890551,549753585599,274844352479,532571746303,549754757117,549755813366,545460764671,541163781119,532441710591,549621069823,274877808639,515396059133,532030685183,527207235583,411242594303,548679974895,411779989502,343596859391,541163782111,549688700415,548547846143,549755805565,539017871359,549487312887,549746372607,549621596029,549738971119,549621595901,549487378111,513215037439,549487377399,549613207423,549621587839,206158428159,532575935999,549739034367,411712880639,549420269503,549739020223,515395026879,532575940351,549755681783,240518152191,257698037503,549621591935,548681940863,515396055039,547608297407,545192411133,545192410623],
		[549755813757,549739032575,549747425247,549755289567,549753716734,549755551739,481036271615,412316860351,549588041727,412316860351,549754765055,549754634239,412316729343,412249751551,549218934783,549737988095,549621596127,545460846589,274877898751,549755682783,549738905599,549755811831,481036335103,549487378427,549755809759,549202165759,532575944695,541132324863,549755681791,549688705015,545460846590,549747425277,549755747327,549755748319,515396074495,549747425247,412316860413,549755772927,412300083199,541165879167,548682071551,549755805567,549705482239,545459798015,412316860287,412314763263,549621579775,549722258943,545460813823,549621596155,549755551727,274877841407,549621465087,539018395647,549755813367,549755748349,515395944447,481036271615,532575940607,549755617279,514859204607,545452457983,549753716734,395136991231],
		[515396075519,547608330239,549755811839,549755797503,549753716735,549755813375,549755813883,549753716735,549755813871,412316860415,549688705023,548682072063,515396075519,481036337151,549751619583,549755813823,549688705023,549755811839,549751619583,549755813375,549755551743,549755813883,547608330239,549755748351,481036337151,549755813631,549755813759,549688705023,412316860415,549747425279,549755813886,549755682815,549755813855,549755748351,549755805695,549722259455,549218942975,549755812863,549755813855,549621596159,532575944703,549753716735,549755813375,549755813871,549755748351,549755797503,532575944703,549755813375,549722259455,549755813759,549218942975,549739036671,532575944703,549755813823,549747425279,547608330239,548682072063,549755813871,274877906943,549688705023,549739036671,547608330239,549747425279,549755813871],
		[549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887,549755813887]
	];
	var statTypes = ["HP", "Atk", "Spd", "Def", "Res"];
	var IVs = ["Neutral", "+HP/−Atk", "+HP/−Spd", "+HP/−Def", "+HP/−Res", "+Atk/−HP", "+Atk/−Spd", "+Atk/−Def", "+Atk/−Res", "+Spd/−HP", "+Spd/−Atk", "+Spd/−Def", "+Spd/−Res", "+Def/−HP", "+Def/−Atk", "+Def/−Spd", "+Def/−Res", "+Res/−HP", "+Res/−Atk", "+Res/−Spd", "+Res/−Def"]; //note the − is the minus symbol and not the common hyphen-minus on keyboard
	var vectorCalcStats = [-35, -28, -21, -14, -7];
	var variations = ["Bane", "Neut", "Boon"];
	var wikiServer = mw.config.get( 'wgServer' );
	var wikiScriptApi = mw.config.get('wgScriptPath') + '/api.php';
	var wikiArticlePath = mw.config.get("wgArticlePath");
	var heroes;
	var heroWeapons;
	var selectedHero;
	var weaponHero;
	var selectedRarity;
	var selectedMerge;
	var useEnemyStats;
	var boonIndex;
	var baneIndex;
	var rarity3Lv1StatSet;
	var selectedLv1Stats = [new Array(3),new Array(3),new Array(3),new Array(3),new Array(3)];
	var selectedLv40Stats = [new Array(3),new Array(3),new Array(3),new Array(3),new Array(3)];
	var selectedCustomLvStats = [new Array(3),new Array(3),new Array(3),new Array(3),new Array(3)];
	var level;
	var growthRates;
	var greatestToLeastIndexes = {}; //Object {Neutral: [#,#,#,#,#], +HP/−Atk: [#,#,#,#,#] ... etc}
	var mergeStatIncreases;
	var baneNeutralizationStatIncreases;
	var weaponStatMod;
	
	document.getElementById("stat-calculator-loading").outerHTML = '<div style=overflow:hidden>' +
  '<div style=float:right;width:82px;height:82px;padding-left:20px>' +
    '<a id=heroIconLink href=#>' +
      '<img id=heroIcon style=width:100%;height:100% src="" onload="$(\'#heroIcon\').show()">' +
    '</a>' +
  '</div>' +
  '<div class=form-group style=overflow:hidden>' +
    '<div class=row-fluid>' +
      '<label class="col-xs-2 col-xs-offset-1 control-label" for=heroSelect style=width:33.333%;float:left;text-align:left>Hero</label>' +
      '<div class=col-xs-4>' +
        '<select id=heroSelect name=heroSelect class=form-control></select>' +
      '</div>' +
    '</div>' +
  '</div>' +
  '<div class=form-group style=overflow:hidden>' +
    '<div class=row-fluid>' +
      '<label class="col-xs-2 col-xs-offset-1 control-label" for=raritySelect style=width:33.333%;float:left;text-align:left>Rarity</label>' +
        '<div class=col-xs-4>' +
          '<select id=raritySelect name=raritySelect class=form-control></select>' +
        '</div>' +
      '</div>' +
    '</div>' +
    '<div class=form-group style=overflow:hidden>' +
      '<div class=row-fluid>' +
        '<label class="col-xs-2 col-xs-offset-1 control-label" for=mergeSelect style=width:33.333%;float:left;text-align:left>Merges</label>' +
      '<div class=col-xs-4>' +
        '<select id=mergeSelect name=mergeSelect class=form-control></select>' +
        '<select id=ivSelect name=ivSelect class=form-control></select>' +
      '</div>' +
    '</div>' +
  '</div>' +
  '<div class=form-group style=overflow:hidden>' +
    '<div id=weaponRow class=row-fluid>' +
      '<label class="col-xs-2 col-xs-offset-1 control-label" style=float:left;text-align:left>Calculate with: ' +
        '<span id=selectedWeapon style=white-space:nowrap></span>' +
      '</label>' +
      '<div class=col-xs-4>' +
        '<input type=checkbox id=weaponSelect name=weaponSelect />' +
      '</div>' +
    '</div>' +
  '</div>' +
  '<div class="form-group" style="overflow: hidden;">' +
    '<div class="row-fluid">' +
      '<label class="col-xs-2 col-xs-offset-1 control-label" for="enemyStatSelect" style="width: 33.333%; float: left; text-align:left;">Use enemy stats:</label>' +
      '<div class="col-xs-4">' +
        '<input type="checkbox" id="enemyStatSelect" name="enemyStatSelect"/>' +
      '</div>' +
    '</div>' +
  '</div>' +
'</div>';
	document.getElementById('LvInput').outerHTML = '<input type="number" id="LvInput" name="LvInput" style="width: 3em;" minlength="1" maxlength="2" size="2" min="1" max="255" value="20" required/>';
	var elements = {
		heroSelect: document.getElementById("heroSelect"),
		raritySelect: document.getElementById('raritySelect'),
		mergeSelect: document.getElementById('mergeSelect'),
		ivSelect: document.getElementById('ivSelect'),
		weaponSelect: document.getElementById('weaponSelect'),
		LvInput: document.getElementById('LvInput'),
		enemyStatSelect: document.getElementById('enemyStatSelect'),
		weaponRow: document.getElementById('weaponRow'),
		selectedWeapon: document.getElementById('selectedWeapon'),
		variationHeaders: document.getElementById('variationHeaders'),
		infoWeapon: document.getElementById('infoWeapon'),
		infoBVID: document.getElementById('infoBVID')
	};

	_populateSelectBox(elements.mergeSelect, ["+0","+1","+2","+3","+4","+5","+6","+7","+8","+9","+10"]);
	_populateSelectBox(elements.ivSelect, IVs);
	
	elements.heroSelect.addEventListener('change', onSelectHeroChange);
	elements.raritySelect.addEventListener('change', onRarityChange);
	elements.mergeSelect.addEventListener('change', onMergeChange);
	elements.ivSelect.addEventListener('change', onMergeChange);
	elements.weaponSelect.addEventListener('change', onWeaponChange);
	elements.enemyStatSelect.addEventListener('change', onAllegianceChange);
	elements.LvInput.addEventListener('change', onLevelChange);
	
	$.getJSON("https://feheroes.fandom.com/api.php" +
		"?action=cargoquery" +
		"&format=json" +
		"&limit=5000" +
		"&tables=Units%3Dh%2CHeroBVIDs%3Db%2CUnitStats%3Ds" +
		"&fields=h._pageName%3DpageName%2CCONCAT(h.Name%2C'%3A%20'%2Ch.Title)%3DHero%2Cb.BVID%3DBVID%2Cs.HPGR3%3DGrowthHP%2Cs.AtkGR3%3DGrowthAtk%2Cs.SpdGR3%3DGrowthSpd%2Cs.DefGR3%3DGrowthDef%2Cs.ResGR3%3DGrowthRes%2CCONCAT(s.Lv1HP5-1)%3DInitHP%2CCONCAT(s.Lv1Atk5-1)%3DInitAtk%2CCONCAT(s.Lv1Spd5-1)%3DInitSpd%2CCONCAT(s.Lv1Def5-1)%3DInitDef%2CCONCAT(s.Lv1Res5-1)%3DInitRes" +
		"&where=IFNULL(Properties__full%2C'')%20NOT%20LIKE%20'%25enemy%25'" +
		"&join_on=h._pageName%3Db.Hero%2Ch.WikiName%3Ds.WikiName" +
		"&group_by=h._pageName").then(function(data) {
		heroes = data.cargoquery;
		$.getJSON("https://feheroes.fandom.com/api.php" +
			"?action=cargoquery" +
			"&format=json" +
			"&limit=5000" +
			"&tables=UnitSkills%3Dh%2CSkills%3Dw%2CUnits%3Du" +
			"&fields=u._pageName%3DhPageName%2Cw.Name%3DWeaponName%2Ch.defaultRarity%3DdefaultRarity%2Cw._pageName%3DwPageName%2Cw.StatModifiers%3DStatModifiers" +
			"&where=Scategory%3D'weapon'%20AND%20w.StatModifiers%20IS%20NOT%20NULL%20AND%20h.defaultRarity%20IS%20NOT%20NULL%20AND%20IFNULL(u.Properties__full%2C'')%20NOT%20LIKE%20'%25enemy%25'" +
			"&join_on=h.skill%3Dw.WikiName%2Ch.WikiName%3Du.WikiName" +
			"&group_by=h.WikiName%2Ch.skill" +
			"&order_by=h.defaultRarity%20DESC").then(function(data) {
			heroWeapons = data.cargoquery;
			initializeHeroList();
		});
	});

	function initializeHeroList() {
		if (!heroes) return;

		var heroList = [];
		
		heroes.forEach(function(hero) { // NEED TESTING
			heroList.push(hero.title.Hero);
		});

		_populateSelectBox(elements.heroSelect, heroList);
		elements.heroSelect.value = heroes[Math.round(Math.random()*(heroList.length-1))].title.Hero;
		onSelectHeroChange();
	}
	
	function initializeRarities() {
		if (!selectedHero) return;
		var ele = elements.raritySelect;
		var rarityList = [5,4,3,2,1];
	
		_populateSelectBox(ele, rarityList);
		ele.value = 5;
	
		onRarityChange();
	}
	
	function forEachStat(doFunction) {
		forEachStatType( function (i) {
			for (var v = 0; v < 3; v++) {
				doFunction(i,v);
			}
		});
	}
	
	function forEachStatType(doFunction) {
		for (var i=0; i < 5; i++) {
			doFunction(i);
		}
	}
	
	function getStatOrderArray(statset) {
		var index = new Array(5);
		for (var z = 0; z < 5; z++) {
			for (var i=4,prev=5; i >= 0; i--) {
				if ( !((statset[i] < statset[prev]) || index.includes(i)) ) { // NEED TESTING
					index[z] = i;
					prev = i;
				}
			}
		}
		return index;
	}
	
	function initializeHeroStats() {
		if (!selectedHero || !selectedRarity) return;
		selectedRarity = parseInt(selectedRarity);
		rarity3Lv1StatSet = [
			selectedHero.InitHP,
			selectedHero.InitAtk,
			selectedHero.InitSpd,
			selectedHero.InitDef,
			selectedHero.InitRes
		].map(function(x) {
			return parseInt(x);
		});
		
		for (var j = 0; j < IVs.length; j++) {
			var IV = IVs[j];
			var plus = IV.match(/\+([\w]*)/);
			var minus = IV.match(/\−([\w]*)/);
			plus = plus == null ? [] : plus;
			minus = minus == null ? [] : minus;
			var incIndex = statTypes.indexOf(plus[1]);
			var decIndex = statTypes.indexOf(minus[1]);
			var IVStatSet = rarity3Lv1StatSet.concat();
			IVStatSet[incIndex]++;
			IVStatSet[decIndex]--;
			greatestToLeastIndexes[IVs[j]] = getStatOrderArray(IVStatSet);
		}
	
		var Lv1StatSet = rarity3Lv1StatSet.map(function(x) {
			return x - 1;
		});
	
		for (var i = 1, nonHPGreatestToLeastIndexes = greatestToLeastIndexes.Neutral.filter(function(x) {
			return x!= 0;
		}), increaseTypeIsHP = false; i < selectedRarity; i++) {
			if (increaseTypeIsHP) {
				for (var index in Lv1StatSet) {
					if (index != nonHPGreatestToLeastIndexes[0] && index != nonHPGreatestToLeastIndexes[1]) {
						Lv1StatSet[index]++;
					}
				}
			} else {
				Lv1StatSet[nonHPGreatestToLeastIndexes[0]]++;
				Lv1StatSet[nonHPGreatestToLeastIndexes[1]]++;
			}
			increaseTypeIsHP = !increaseTypeIsHP;
		}
		
		growthRates = [
			selectedHero.GrowthHP,
			selectedHero.GrowthAtk,
			selectedHero.GrowthSpd,
			selectedHero.GrowthDef,
			selectedHero.GrowthRes
		].map(function(x) {
			return parseInt(x);
		});
		
		forEachStat(function(i,v) {
			selectedLv1Stats[i][v] = Lv1StatSet[i]+(v-1);
		});
		
		forEachStatType(function(i) {
			selectedLv40Stats[i] = getLv40StatArray(Lv1StatSet[i],growthRates[i],selectedRarity);
		});
	}
	
	function getLv40StatArray(lv1NeutStat, growthRate, rarity) {
		var bane = lv1NeutStat - 1 + getGrowthValue(growthRate - 5, rarity);
		var neut = lv1NeutStat + getGrowthValue(growthRate, rarity);
		var boon = lv1NeutStat + 1 + getGrowthValue(growthRate + 5, rarity);
		return [bane, neut, boon];
	}
	
	function getGrowthValue(growthRate, rarity) {
		return Math.trunc(0.39 * getAppliedGrowthRate(growthRate, rarity));
	}
	
	function getAppliedGrowthRate(growthRate, rarity) {
		return Math.trunc(growthRate * (0.79 + (0.07 * rarity)));
	}
	
	function updateHeroIcon() {
		$("#heroIcon").hide();

		var decodedPageName = selectedHero.pageName;
		var url = "?action=query&prop=imageinfo&iiprop=url&titles=File:"+ decodedPageName.replace(/[^À-ɏḀ-ỿ\w\d\s._-]/g, "") +"_Face_FC.png&format=json";
	
			url = encodeURI(wikiServer + wikiScriptApi + url);
		$.get(url, function(data) {
			var pages = data.query.pages;
			$("#heroIcon").attr('src', pages[Object.keys(pages)[0]].imageinfo[0].url);
		});
		$("#heroIconLink").attr('href', wikiServer + wikiArticlePath.replace("$1", encodeURIComponent(decodedPageName)));
	}
	
	function onSelectHeroChange() {
		var value = elements.heroSelect.value;
		for (var h=0; h<heroes.length; h++) {
			var hero = heroes[h].title;
			if (hero.pageName == value) {
				selectedHero = hero;
				break;
			}
		}
		//if (!selectedHero) selectedHero = {};
		initializeRarities();
		updateHeroIcon();
	}
	
	function onRarityChange() {
		selectedRarity = elements.raritySelect.value;
		initializeHeroStats();
		weaponHero = null;
		for (var h=0; h<heroWeapons.length; h++) {
			var hw = heroWeapons[h].title;
			if (hw.hPageName == selectedHero.pageName && parseInt(hw.defaultRarity) <= selectedRarity) {
				weaponHero = hw;
				break;
			}
		}

		if (weaponHero == null) {
			elements.weaponRow.style.display = "none";
		} else {
			elements.weaponRow.style = null;
			elements.selectedWeapon.innerHTML = "<a href=\""+wikiArticlePath.replace("$1", encodeURIComponent(weaponHero.wPageName))+"\">"+weaponHero.WeaponName+"</a>";
		}
		getWeaponStatModData(elements.weaponSelect);
		getMergeData(elements.mergeSelect);
		getLevelData(elements.LvInput);
		populateStatFields();
		populateDebugInfo();
	}
	
	function getMergeData(obj) {
		selectedMerge = parseInt(obj.value.slice(1));
		var selectedIV = elements.ivSelect.value;
		var plus = selectedIV.match(/\+([\w]*)/);
		var minus = selectedIV.match(/\−([\w]*)/);
		plus = plus == null ? [] : plus;
		minus = minus == null ? [] : minus;
		boonIndex = statTypes.indexOf(plus[1]);
		baneIndex = statTypes.indexOf(minus[1]);
	
		mergeStatIncreases = [0,0,0,0,0];
		baneNeutralizationStatIncreases = [[0,0,0,0,0],[0,0,0,0,0]];
	
		for (var i = 0, increaseIndex = 0; i < selectedMerge * 2; i++, increaseIndex++) {
			if (increaseIndex == 5) {
				increaseIndex = 0;
			}
			mergeStatIncreases[greatestToLeastIndexes[selectedIV][increaseIndex]]++;
		}
		
		if (selectedMerge >= 1) {
			if (baneIndex == -1) {
				baneNeutralizationStatIncreases[0][greatestToLeastIndexes[selectedIV][0]]++;
				baneNeutralizationStatIncreases[0][greatestToLeastIndexes[selectedIV][1]]++;
				baneNeutralizationStatIncreases[0][greatestToLeastIndexes[selectedIV][2]]++;
				baneNeutralizationStatIncreases[1][greatestToLeastIndexes[selectedIV][0]]++;
				baneNeutralizationStatIncreases[1][greatestToLeastIndexes[selectedIV][1]]++;
				baneNeutralizationStatIncreases[1][greatestToLeastIndexes[selectedIV][2]]++;
			} else {
				baneNeutralizationStatIncreases[0][baneIndex] += (selectedLv1Stats[baneIndex][1] - selectedLv1Stats[baneIndex][0]);
				baneNeutralizationStatIncreases[1][baneIndex] += (selectedLv40Stats[baneIndex][1] - selectedLv40Stats[baneIndex][0]);
			}
		}
	}
	function onMergeChange() {
		getMergeData(elements.mergeSelect);
		populateStatFields();
	}
	
	function getWeaponStatModData(obj) {
		weaponStatMod = [0,0,0,0,0];
		if (obj.checked && weaponHero != null) {
			var nullStatMod = weaponHero.StatModifiers == "";
			if (nullStatMod) {
				weaponStatMod = [NaN,NaN,NaN,NaN,NaN];
			}
			weaponStatMod = weaponHero.StatModifiers.split(",").map(function(x) {
				return parseInt(x);
			});
		}
	}
	
	function onWeaponChange() {
		getWeaponStatModData(elements.weaponSelect);
		populateStatFields();
	}
	
	function onAllegianceChange() {
		useEnemyStats = elements.enemyStatSelect.checked;
		getLevelData(elements.LvInput);
		updateLvlUStatFields();
	}
	
	
	function getLevelData(obj) {
		level = parseInt(obj.value);
		if (level < 1 || isNaN(level)) {
			level = -1;
			return;
		} else if (level == 1) {
			forEachStat(function(i,v) {selectedCustomLvStats[i][v] = selectedLv1Stats[i][v];});
			return;
		} else if (level == 40) {
			forEachStat(function(i,v) {selectedCustomLvStats[i][v] = selectedLv40Stats[i][v];});
			return;
		}
		if (level > 40 || useEnemyStats) {
			forEachStat(function(i,v){
				var thisGrowthRate = growthRates[i]+(5*(v-1));
				selectedCustomLvStats[i][v] = selectedLv1Stats[i][v] + Math.trunc(((level-1)/100) * Math.trunc(thisGrowthRate * (0.79 + (0.07 * selectedRarity))));
			});
		} else if (level > 1 && level < 40) {
			//Temporary code: Don't show calculations if bane neutralization is active
			if (parseInt(elements.mergeSelect.value.slice(1)) >= 1) {
				selectedCustomLvStats = [[NaN,NaN,NaN],[NaN,NaN,NaN],[NaN,NaN,NaN],[NaN,NaN,NaN],[NaN,NaN,NaN]];
				return;
			}
	
			var BVID = parseInt("0x"+selectedHero.BVID);
			if (isNaN(BVID)) {
				level = -2;
				return;
			}
			var rarity5Lv1StatSet = rarity3Lv1StatSet.map(function(e) {
				return e + 1;
			});
			forEachStat(function(i,v) {
				var thisGrowthRate = growthRates[i]+(5*(v-1));
				var currentVectorAsString = growthVectors[getGrowthValue(thisGrowthRate, selectedRarity) - 1][(3 * rarity5Lv1StatSet[i] + vectorCalcStats[i] + Math.trunc(thisGrowthRate * (0.79 + (0.07 * selectedRarity))) + BVID) % 64].toString(2).padStart(39, "0"); //access growth vector at growthVectors[growthValue-1][ID]
				var currentGrowthValue = 0;
				for (var t = 0; t < level-1; t++) {
					currentGrowthValue += parseInt(currentVectorAsString.charAt(t));
				}
				selectedCustomLvStats[i][v] = selectedLv1Stats[i][v] + currentGrowthValue;
			});
		}
	}
	
	function onLevelChange() {
		getLevelData(elements.LvInput);
		updateLvlUStatFields();
	}
	
	function populateStatFields() {
		var finalLv1Stats, finalLv40Stats;
		if (selectedMerge == 0) {
			elements.variationHeaders.style = null;
	
			finalLv1Stats = [
				selectedLv1Stats[0].map(function(e) { return statLimit( positivePart(e + weaponStatMod[0]) ); }),
				selectedLv1Stats[1].map(function(e) { return statLimit( positivePart(e + weaponStatMod[1]) ); }),
				selectedLv1Stats[2].map(function(e) { return statLimit( positivePart(e + weaponStatMod[2]) ); }),
				selectedLv1Stats[3].map(function(e) { return statLimit( positivePart(e + weaponStatMod[3]) ); }),
				selectedLv1Stats[4].map(function(e) { return statLimit( positivePart(e + weaponStatMod[4]) ); })
			];

			finalLv40Stats = [
				selectedLv40Stats[0].map(function(e) { return statLimit( positivePart(e + weaponStatMod[0]) ); }),
				selectedLv40Stats[1].map(function(e) { return statLimit( positivePart(e + weaponStatMod[1]) ); }),
				selectedLv40Stats[2].map(function(e) { return statLimit( positivePart(e + weaponStatMod[2]) ); }),
				selectedLv40Stats[3].map(function(e) { return statLimit( positivePart(e + weaponStatMod[3]) ); }),
				selectedLv40Stats[4].map(function(e) { return statLimit( positivePart(e + weaponStatMod[4]) ); })
			];
	
			forEachStat(function(i,v) {
				var statType = statTypes[i];
				var variation = variations[v];
				
				var lv1 = finalLv1Stats[i][v];
				lv1 = isNaN(lv1) ? "?" : lv1;
				var lv40 = finalLv40Stats[i][v];
				lv40 = isNaN(lv40) ? "?" : lv40;
				
				var ele1 = document.getElementById(statType + "Lv1"+variation);
				var ele40 = document.getElementById(statType + "Lv40"+variation);
				
				ele1.style.visibility = null;
				ele40.style.visibility = null;
	
	
				document.getElementById(statType + "Lv1"+variation).textContent = lv1;
				document.getElementById(statType + "Lv40"+variation).textContent = lv40;
				if ((v == 0 && i == baneIndex) || (v == 1 && baneIndex == -1) || (v == 2 && i == boonIndex) || (v == 1 && i != boonIndex && i!= baneIndex)) {
					$("#"+statType+"Lv1"+variation).wrapInner("<b></b>");
					$("#"+statType+"Lv40"+variation).wrapInner("<b></b>");
				}
			});
		} else {
			elements.variationHeaders.style.display = "none";
			finalLv1Stats = [
				statLimit( positivePart(selectedLv1Stats[0][1] + mergeStatIncreases[0] + baneNeutralizationStatIncreases[0][0]+ weaponStatMod[0]) ),
				statLimit( positivePart(selectedLv1Stats[1][1] + mergeStatIncreases[1] + baneNeutralizationStatIncreases[0][1]+ weaponStatMod[1]) ),
				statLimit( positivePart(selectedLv1Stats[2][1] + mergeStatIncreases[2] + baneNeutralizationStatIncreases[0][2]+ weaponStatMod[2]) ),
				statLimit( positivePart(selectedLv1Stats[3][1] + mergeStatIncreases[3] + baneNeutralizationStatIncreases[0][3]+ weaponStatMod[3]) ),
				statLimit( positivePart(selectedLv1Stats[4][1] + mergeStatIncreases[4] + baneNeutralizationStatIncreases[0][4]+ weaponStatMod[4]) )
			];
	
	
			finalLv40Stats = [
				statLimit( positivePart(selectedLv40Stats[0][1] + mergeStatIncreases[0] + baneNeutralizationStatIncreases[1][0] + weaponStatMod[0]) ),
				statLimit( positivePart(selectedLv40Stats[1][1] + mergeStatIncreases[1] + baneNeutralizationStatIncreases[1][1] + weaponStatMod[1]) ),
				statLimit( positivePart(selectedLv40Stats[2][1] + mergeStatIncreases[2] + baneNeutralizationStatIncreases[1][2] + weaponStatMod[2]) ),
				statLimit( positivePart(selectedLv40Stats[3][1] + mergeStatIncreases[3] + baneNeutralizationStatIncreases[1][3] + weaponStatMod[3]) ),
				statLimit( positivePart(selectedLv40Stats[4][1] + mergeStatIncreases[4] + baneNeutralizationStatIncreases[1][4] + weaponStatMod[4]) )
			];
	
			if (baneIndex != -1) {
				finalLv1Stats[baneIndex] = statLimit( positivePart(selectedLv1Stats[baneIndex][0] + mergeStatIncreases[baneIndex] + weaponStatMod[baneIndex]) );
				finalLv40Stats[baneIndex] = statLimit( positivePart(selectedLv40Stats[baneIndex][0] + mergeStatIncreases[baneIndex] + weaponStatMod[baneIndex]) );
			}
			if (boonIndex != -1) {
				finalLv1Stats[boonIndex] = statLimit( positivePart(selectedLv1Stats[boonIndex][2] + mergeStatIncreases[boonIndex] + weaponStatMod[boonIndex]) );
				finalLv40Stats[boonIndex] = statLimit( positivePart(selectedLv40Stats[boonIndex][2] + mergeStatIncreases[boonIndex] + weaponStatMod[boonIndex]) );
			}
	
			forEachStatType(function(i) {
				var statType = statTypes[i];
				document.getElementById(statType + "Lv1Bane").style.visibility = "hidden";
				document.getElementById(statType + "Lv40Bane").style.visibility = "hidden";
				document.getElementById(statType + "LvUBane").style.visibility = "hidden";
				document.getElementById(statType + "Lv1Boon").style.visibility = "hidden";
				document.getElementById(statType + "Lv40Boon").style.visibility = "hidden";
				document.getElementById(statType + "LvUBoon").style.visibility = "hidden";
	
				var lv1 = finalLv1Stats[i];
				lv1 = isNaN(lv1) ? "?" : lv1;
				var lv40 = finalLv40Stats[i];
				lv40 = isNaN(lv40) ? "?" : lv40;
	
				document.getElementById(statType + "Lv1Neut").textContent = lv1;
				document.getElementById(statType + "Lv40Neut").textContent = lv40;
				$("#"+statType+"Lv1Neut").wrapInner("<b></b>");
				$("#"+statType+"Lv40Neut").wrapInner("<b></b>");
			});
		}
		updateLvlUStatFields();
	}
	
	function updateLvlUStatFields() {
		var finalCustomLvStats;
		if (selectedMerge == 0) {
			finalCustomLvStats = [
				selectedCustomLvStats[0].map(function(e) { return statLimit( positivePart(e + weaponStatMod[0]) ); }),
				selectedCustomLvStats[1].map(function(e) { return statLimit( positivePart(e + weaponStatMod[1]) ); }),
				selectedCustomLvStats[2].map(function(e) { return statLimit( positivePart(e + weaponStatMod[2]) ); }),
				selectedCustomLvStats[3].map(function(e) { return statLimit( positivePart(e + weaponStatMod[3]) ); }),
				selectedCustomLvStats[4].map(function(e) { return statLimit( positivePart(e + weaponStatMod[4]) ); })
			];
	
			forEachStat(function(i,v) {
				var statType = statTypes[i];
				var variation = variations[v];
	
				var lvU = finalCustomLvStats[i][v];

				var eleU = document.getElementById(statType + "LvU"+variation);
	
				eleU.style.visibility = null;
	
				if (level == -2 || isNaN(lvU)) {
					eleU.textContent = "?";
				} else if (level > 0) {
					eleU.textContent = finalCustomLvStats[i][v];
				} else if (level == -1) {
					eleU.textContent = "—";
				}
				if ((v == 0 && i == baneIndex) || (v == 1 && baneIndex == -1) || (v == 2 && i == boonIndex) || (v == 1 && i != boonIndex && i!= baneIndex)) {
					$("#"+statType+"LvU"+variation).wrapInner("<b></b>");
				}
			});
		} else {
			finalCustomLvStats = [
				statLimit( positivePart(selectedCustomLvStats[0][1] + mergeStatIncreases[0] + weaponStatMod[0]) ),
				statLimit( positivePart(selectedCustomLvStats[1][1] + mergeStatIncreases[1] + weaponStatMod[1]) ),
				statLimit( positivePart(selectedCustomLvStats[2][1] + mergeStatIncreases[2] + weaponStatMod[2]) ),
				statLimit( positivePart(selectedCustomLvStats[3][1] + mergeStatIncreases[3] + weaponStatMod[3]) ),
				statLimit( positivePart(selectedCustomLvStats[4][1] + mergeStatIncreases[4] + weaponStatMod[4]) )
			];
			if (baneIndex != -1) {
				finalCustomLvStats[baneIndex] = statLimit( positivePart(selectedCustomLvStats[baneIndex][0] + mergeStatIncreases[baneIndex] + weaponStatMod[baneIndex]) );
			}
			if (boonIndex != -1) {
				finalCustomLvStats[boonIndex] = statLimit( positivePart(selectedCustomLvStats[boonIndex][2] + mergeStatIncreases[boonIndex] + weaponStatMod[boonIndex]) );
			}
	
			forEachStatType(function(i) {
				var statType = statTypes[i];
				document.getElementById(statType + "LvUBane").style.visibility = "hidden";
				document.getElementById(statType + "LvUBoon").style.visibility = "hidden";
	
				var lvU = finalCustomLvStats[i];
	
				if (level == -2 || isNaN(lvU)) {
					document.getElementById(statType + "LvUNeut").textContent = "?";
				} else if (level > 0) {
					document.getElementById(statType + "LvUNeut").textContent = finalCustomLvStats[i];
				} else if (level == -1) {
					document.getElementById(statType + "LvUNeut").textContent = "—";
				}
				$("#"+statType+"LvUNeut").wrapInner("<b></b>");
			});
		}
	}
	
	function populateDebugInfo() {
		if (weaponHero) {
			var wpInfo = "";
			var wpArray = weaponHero.StatModifiers.split(",").map(function(x) {
				return parseInt(x);
			});
			for (var index in wpArray) {
				var num = wpArray[index];
				if (num != 0 && (!isNaN(num))) {
					var sign = num > 0 ? "+" : "";
					wpInfo += ", "+statTypes[index]+sign+wpArray[index];
				}
			}
			wpInfo = wpInfo.slice(2);
			elements.infoWeapon.textContent = wpInfo;
		}
	
		forEachStatType(function (i) {
			document.getElementById("infoGrowths"+statTypes[i]).textContent = getAppliedGrowthRate(growthRates[i], selectedRarity);
		});
	
		elements.infoBVID.textContent = "0x"+selectedHero.BVID;
	}
	
	function positivePart(x) {
		return isNaN(x) ? NaN : (x > 0 ? x : 0);
	}
	
	function statLimit(x) {
		return isNaN(x) ? NaN : (x > 99 ? 99 : x);
	}
	
	function _populateSelectBox(ele, list, defaultIndex) {
		ele.options.length = 0;
		for (var i = 0; i < list.length; i++) {
			var opt = document.createElement('option');
			opt.textContent = list[i];
			opt.value = list[i];
			ele.appendChild(opt);
		}
		ele.selectedIndex = defaultIndex || 0;
	}
});