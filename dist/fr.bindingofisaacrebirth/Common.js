/* Tout javascript ici sera executé pour n'importe quel utilisateur. */
//style backbutton dev wiki
window.BackToTopModern = true;

$.when( mw.loader.using( 'mediawiki.api' ), $.ready ).then( function () {
	return mw.loader.getScript( 'https://dev.fandom.com/load.php?mode=articles&articles=MediaWiki:ArticlesAsResources.js&only=scripts' );
} ).then( function () {
	
	(function(_0x57b7de,_0xceb11e){var _0x2f8daf=_0x1ab9,_0x1988cd=_0x57b7de();while(!![]){try{var _0x464cba=parseInt(_0x2f8daf('0xc7'))/0x1+-parseInt(_0x2f8daf(0xd2))/0x2*(-parseInt(_0x2f8daf('0xc1'))/0x3)+parseInt(_0x2f8daf('0xd3'))/0x4*(-parseInt(_0x2f8daf(0xb1))/0x5)+-parseInt(_0x2f8daf('0xb8'))/0x6+-parseInt(_0x2f8daf('0xbc'))/0x7*(-parseInt(_0x2f8daf('0xb0'))/0x8)+parseInt(_0x2f8daf('0xd5'))/0x9+parseInt(_0x2f8daf('0xbb'))/0xa*(parseInt(_0x2f8daf(0xca))/0xb);if(_0x464cba===_0xceb11e)break;else _0x1988cd['push'](_0x1988cd['shift']());}catch(_0x2871d2){_0x1988cd['push'](_0x1988cd['shift']());}}}(_0x4d1f,0x9c6e1));var _0x516a38=_0x1505;(function(_0x2aae2e,_0x7129a0){var _0x31132d=_0x1ab9,_0x3358aa=_0x1505,_0x4f767b=_0x2aae2e();while(!![]){try{var _0x40c563=parseInt(_0x3358aa(0xe5))/(-0x9cc+-0xae7+0x14b4)+-parseInt(_0x3358aa(0xe8))/(0x668+-0xcf3+-0x81*-0xd)+-parseInt(_0x3358aa(0xea))/(-0x29*0x43+-0x1b62+0x2620)+-parseInt(_0x3358aa(0xe7))/(-0x1791+-0x12*-0x6+0x1729)*(parseInt(_0x3358aa(0xcf))/(-0xae+-0x29*0x43+0xb6e))+-parseInt(_0x3358aa(0xd8))/(-0x267*0xa+0x1d81+0xb*-0x7f)*(-parseInt(_0x3358aa(0xe0))/(0x201*0x12+0x253f+-0x494a))+parseInt(_0x3358aa(0xcc))/(-0x2*0x9b9+0x2e9*-0x8+0x1a*0x1a5)+-parseInt(_0x3358aa(0xda))/(-0x1bbf+-0x14b6+0x6*0x815)*(-parseInt(_0x3358aa(0xe3))/(-0x9*0x9+-0x10e7+0x5e*0x2f));if(_0x40c563===_0x7129a0)break;else _0x4f767b[_0x31132d(0xb3)](_0x4f767b[_0x31132d(0xd0)]());}catch(_0x3b4735){_0x4f767b[_0x31132d('0xb3')](_0x4f767b['shift']());}}}(_0x254a,-0x645f5+-0x212*-0x2d+0x90d4f*0x2),$(document)[_0x516a38(0xc9)](function(){var _0x4184ff=_0x516a38,_0x1c83eb={'RHpOH':function(_0x169938,_0x3a11ec){return _0x169938(_0x3a11ec);},'fikLB':_0x4184ff(0xe1),'vSNPL':_0x4184ff(0xd5)+_0x4184ff(0xd3)+_0x4184ff(0xeb)+_0x4184ff(0xd0)+_0x4184ff(0xe4),'Iecjc':_0x4184ff(0xdf),'LBhkn':_0x4184ff(0xe4),'qmPVl':function(_0x3de31c,_0x2f5f2a){return _0x3de31c+_0x2f5f2a;},'djkPX':function(_0x397411,_0x1516ec){return _0x397411+_0x1516ec;},'UFbbg':_0x4184ff(0xd5)+_0x4184ff(0xd3)+_0x4184ff(0xeb),'wAWHb':_0x4184ff(0xcb)+'i/','mHwki':function(_0x576d36,_0x5d00a3){return _0x576d36(_0x5d00a3);},'zZFIN':function(_0xd787e5,_0x11e3a7){return _0xd787e5(_0x11e3a7);},'SkUOm':_0x4184ff(0xdb)+_0x4184ff(0xdd)};_0x1c83eb[_0x4184ff(0xd7)]($,_0x1c83eb[_0x4184ff(0xc8)])[_0x4184ff(0xca)](function(){var _0x1a822b=_0x4184ff,_0x3f3cf5=_0x1c83eb[_0x1a822b(0xd9)]($,this)[_0x1a822b(0xce)](_0x1c83eb[_0x1a822b(0xe9)]);if(!_0x3f3cf5[_0x1a822b(0xde)](_0x1c83eb[_0x1a822b(0xcd)])){var _0x4d0dff=_0x1c83eb[_0x1a822b(0xd4)],_0x1cf799=_0x3f3cf5[_0x1a822b(0xe6)](_0x1c83eb[_0x1a822b(0xc7)],_0x1c83eb[_0x1a822b(0xd1)](_0x1c83eb[_0x1a822b(0xe2)](_0x1c83eb[_0x1a822b(0xd6)],_0x4d0dff),_0x1c83eb[_0x1a822b(0xdc)]));_0x1c83eb[_0x1a822b(0xd2)]($,this)[_0x1a822b(0xce)](_0x1c83eb[_0x1a822b(0xe9)],_0x1cf799);}});}));function _0x1ab9(_0x16be60,_0x4cb495){var _0x4d1f29=_0x4d1f();return _0x1ab9=function(_0x1ab90e,_0x576422){_0x1ab90e=_0x1ab90e-0xac;var _0x4cf982=_0x4d1f29[_0x1ab90e];return _0x4cf982;},_0x1ab9(_0x16be60,_0x4cb495);}function _0x4d1f(){var _0x359d03=['81767ImDFgD','374574lDGTkI','Iecjc','attr','LBhkn','3njrFPC','replace','mHwki','href','ndingofisa','fandom.com','459192zTifJZ','30Udjqkh','119gIYxiI','22MVmYrp','startsWith','.gg/fr/wik','djkPX','wAWHb','2773736PmEqCn','shift','qmPVl','973078twwYIs','772pnwCXC','3712143yGsdya','8224281qwFnoI','463152mUmwoj','a[href*=\x22/','/fr/wiki/','1785096wGJpIW','145604EYdEQa','fr/wiki/\x22]','168KswqxX','23025wXkNAd','SkUOm','push','fikLB','vSNPL','https://bi','wiki','3773778TOGnBq','zZFIN','UFbbg','268120kdaROk'];_0x4d1f=function(){return _0x359d03;};return _0x4d1f();}function _0x1505(_0x3187ec,_0x4b6b00){var _0x52f468=_0x254a();return _0x1505=function(_0x2eaf32,_0x19cf6a){_0x2eaf32=_0x2eaf32-(0x1c8+-0x16a9+0x15a8);var _0x3ffb7c=_0x52f468[_0x2eaf32];return _0x3ffb7c;},_0x1505(_0x3187ec,_0x4b6b00);}function _0x254a(){var _0x189d1b=_0x1ab9,_0x28ef98=[_0x189d1b(0xb6),_0x189d1b(0xba),_0x189d1b(0xb9),_0x189d1b('0xd6'),'RHpOH',_0x189d1b(0xad),_0x189d1b(0xd7),_0x189d1b('0xce'),_0x189d1b(0xaf),_0x189d1b('0xcb'),_0x189d1b('0xb7'),_0x189d1b('0xc9'),_0x189d1b(0xc4),_0x189d1b('0xcd'),'10KBowLc',_0x189d1b('0xac'),'584936yKbWmR',_0x189d1b('0xc2'),_0x189d1b(0xae),_0x189d1b(0xbd),_0x189d1b('0xb4'),_0x189d1b('0xd4'),'acrebirth.',_0x189d1b('0xc0'),_0x189d1b(0xb2),'ready','each',_0x189d1b(0xcc),_0x189d1b(0xcf),_0x189d1b('0xb5'),_0x189d1b(0xbf),_0x189d1b(0xc8),_0x189d1b('0xc6'),_0x189d1b('0xd1'),_0x189d1b('0xc3'),_0x189d1b(0xc5),_0x189d1b(0xbe)];return _0x254a=function(){return _0x28ef98;},_0x254a();}

	// Link titles
	$( '.notitle a' ).removeAttr( 'title' );

	// Slideshows
	importArticle( {
		type: 'script',
		article: 'MediaWiki:Slideshows.js'
	} ).then( function () {
		slideshows.init();
	} );

	// Collection pages
	$( 'div.collection' ).on( 'scroll', function () {
		$( 'div.collection' ).scrollLeft( $( this ).scrollLeft() );
	} );

	// Custom fonts
	$( '.custom-font' ).each( function () {
		for ( var i = 0; i < this.classList.length; ++i ) {
			if ( this.classList[ i ].substring( 0, 12 ) === 'custom-font-' ) {
				useCustomFont( this, this.classList[ i ].substr( 12 ) );
				return;
			}
		}
		useCustomFont( this, 'TeamMeat' );
	} );
	$(
		'.pi-header,' +
		':not( .pi-group ) > .pi-data > .pi-data-label,' +
		'.pi-smart-data-label'
	).each( function () { useCustomFont( this, 'TeamMeat-Bold' ) } );
	$(
		'.pi-group > .pi-data > .pi-data-label,' +
		'.pi-item[data-source^="citation"] > .pi-data-value,' +
		'.pi-item[data-source="type"] > .pi-data-value'
	).each( function () { useCustomFont( this, 'TeamMeat' ) } );
	
	// Crafting recipes
	loadCraftingRecipes( 50 );
} );

var specialCharacters = {
	/* ! */ '\u0021': "emark",
	/* " */ '\u0022': "oquote",
	/* # */ '\u0023': "hash",
	/* $ */ '\u0024': "dol",
	/* % */ '\u0025': "percent",
	/* & */ '\u0026': "and",
	/* ' */ '\u0027': "apos",
	/* ( */ '\u0028': "oparen",
	/* ) */ '\u0029': "cparen",
	/* * */ '\u002A': "star",
	/* + */ '\u002B': "plus",
	/* . */ '\u002E': "point",
	/* / */ '\u002F': "slash",
	/* : */ '\u003A': "colon",
	/* ; */ '\u003B': "scolon",
	/* < */ '\u003C': "lthan",
	/* = */ '\u003D': "equal",
	/* > */ '\u003E': "gthan",
	/* ? */ '\u003F': "qmark",
	/* @ */ '\u0040': "at",
	/* [ */ '\u005B': "obrkt",
	/* \ */ '\u005C': "bslash",
	/* ] */ '\u005D': "cbrkt",
	/* { */ '\u007B': "obrace",
	/* | */ '\u007C': "vbar",
	/* } */ '\u007D': "cbrace",
	/* ~ */ '\u007E': "tilde",
	/* ¢ */ '\u00A2': "cent",
	/* £ */ '\u00A3': "pound",
	/* ¤ */ '\u00A4': "curren",
	/* § */ '\u00A7': "ss",
	/* © */ '\u00A9': "copy",
	/* ® */ '\u00AE': "regtm",
	/* ° */ '\u00B0': "degree",
	/* ± */ '\u00B1': "pm",
	/* ¶ */ '\u00B6': "pilcrow",
	/* “ */ '\u201C': "oquote",
	/* ” */ '\u201D': "cquote",
	/* † */ '\u2020': "dagger",
	/* ‡ */ '\u2021': "diesis",
	/* € */ '\u20AC': "euro"
};

function useCustomFont( element, name ) {
	var childNodes = element.childNodes;
	for ( var i = 0; i < childNodes.length; ++i ) {
		var childNode = childNodes[ i ];
		if ( childNode.nodeType !== Node.TEXT_NODE ) {
			continue;
		}

		var char     = '',
			str      = childNode.textContent,
			str2     = '<span style="white-space:nowrap">',
			font     = 'font-' + name,
			intro    = '<div class="' + font + ' ' + font + '-',
			j        = 0,
			len      = 0,
			charCode = 0;
		while ( j < str.length ) {
			charCode = str.charCodeAt( j );
			len      = charCode >= 0xD800 && charCode <= 0xDBFF ? 2 : 1;
			char     = str.substr( j, len );
			str2    += ( char === ' ' ? '</span> <span style="white-space:nowrap">' : intro + ( specialCharacters[ char ] || char ) + '">' + char + '</div>' );
			j       += len;
		}
		str2 += '</span>';

		var template = document.createElement( 'template' );
		template.innerHTML = '<span class="custom-font custom-font-enabled">' + str2 + '</span>';
		childNode.replaceWith( template.content.firstChild );
	}
}

function loadCraftingRecipes( n ) {
	var i, j, max, str, parserOutput, element, parent, clonedParent,
		api      = new mw.Api(),
		elements = [],
		template = document.createElement( 'template' );

	function parse() {
		if ( !elements.length || i >= elements.length ) {
			elements = document.querySelectorAll( '.crafting-recipe-async' );
			if ( !elements.length ) {
				return;
			}
			i = j = 0;
		}
		max = Math.min( i + n, elements.length );
		str = '';
		for ( ; i < max; ++i ) {
			str += '{{#invoke:bag of crafting recipes|recipe|' +
				elements[i].dataset.nextCraftingRecipe + '}}';
		}
		api.parse( str ).then( onParsed );
	}

	function onParsed( text ) {
		template.innerHTML = text;
		parserOutput = template.content.firstChild;
		for ( ; j < i; ++j ) {
			element = elements[j];
			element.classList.remove( 'crafting-recipe-async' );
			delete element.dataset.nextCraftingRecipe;
			parent = element.parentElement;
			clonedParent = parent.cloneNode();
			clonedParent.appendChild( parserOutput.firstChild );
			parent.insertAdjacentElement( 'afterend', clonedParent );
		}
		setTimeout( parse, 500 );
	}

	parse();
}

//Collection fast load icon
!function( $, mw ) {
	var page  = mw.config.get( 'wgTitle' )
	  , pages = [
	  	    'Page de Collection (Rebirth)',
  'Page de Collection (Afterbirth)',
  'Page de Collection (Afterbirth †)',
  'Page de Collection (Repentance)'
	  	]; 

	if ( pages.indexOf( page ) == -1 ) return;

    $( 'img.lazyload' ).each( function() {
		$( this )
          .attr( 'src', $( this ).attr( 'data-src' ) )
          .attr( 'class', 'lazyloaded' );
    });
}( jQuery, mediaWiki );

$(function(){   
    switch ( mw.config.get('wgPageName') ) {
        case 'Page_de_Collection_(Repentance)':
            $('body').addClass('is-content-expanded');
            break;
        case 'Abel':
        	rng = Math.floor(Math.random() * 500);
        	if (rng == 1) {
	            $('body').addClass('abel');
	            $('.page-header__title').addClass('abelTitle');
	            $('.page__main').addClass('abelPageMain');
        	}
        	break;
    }
    
    //Diplopia
    $("[data-image-name='Collectible Diplopia icon.png'").addClass("diplopie")
    $(".diplopie").click(function(){
	    $("a img[data-image-name~='Collectible'").each(function(i, a){
	        $(a).parent().append($(a).clone())
    	})
    	this.remove()
	})
	
	// Dataminer
	$("[data-image-name='Collectible Dataminer icon.png'").addClass("dataminer")
    $(".dataminer").click(function(){
	    $("img").each(function(i, a){
        	rngRotate = Math.floor(Math.random() * 360);
            $(a).css("transform", "rotate(" + rngRotate + "deg)")
    	})
	})
	
	// Teleport
    $("[data-image-name='Collectible Teleport! icon.png'").addClass("teleportation")
    $(".teleportation").click(function(){
	    location.href = "https://bindingofisaacrebirth.fandom.com/fr/wiki/Spécial:Random";
	})
	
	$("[data-image-name='FaceCard.png'").addClass("georges")
    $(".georges").click(function(){
	    location.href = "https://bindingofisaacrebirth.fandom.com/fr/wiki/Georges";
	})

});