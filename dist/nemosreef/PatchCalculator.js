//PatchCalculator

var out='<p>Your current number of patches:';
out+='<input id="numPatches" value="10" size="4">';
out+='<br>Number of patches to sell:';
out+='<input id="sellPatches" value="1" size="4">';
out+='<br>Number of patches to buy:';
out+='<input id="buyPatches" value="1" size="4">';
out+='<br><input type="button" id="btnCalc" name="btnCalc" value="Calculate" />';
out+='</p>';
out+='<div id="divResult"></div>';

$("p:contains('(Insert here)')").html(out);

//replace vitalityPatchList from worldDef here:
var vitalityPatchList=[{"vitality":3500,"order":1,"cost":{"virtualMoney":80,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":3500,"order":2,"cost":{"virtualMoney":90,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":3500,"order":3,"cost":{"virtualMoney":100,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":10500,"order":4,"cost":{"virtualMoney":110,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":11500,"order":5,"cost":{"virtualMoney":120,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":12500,"order":6,"cost":{"virtualMoney":130,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":18000,"order":7,"cost":{"virtualMoney":150,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":19000,"order":8,"cost":{"virtualMoney":160,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":20000,"order":9,"cost":{"virtualMoney":180,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":21000,"order":10,"cost":{"virtualMoney":200,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":22100,"order":11,"cost":{"virtualMoney":220,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":23000,"order":12,"cost":{"virtualMoney":240,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":23000,"order":13,"cost":{"virtualMoney":270,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":28000,"order":14,"cost":{"virtualMoney":300,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":29750,"order":15,"cost":{"virtualMoney":330,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":31500,"order":16,"cost":{"virtualMoney":370,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":33250,"order":17,"cost":{"virtualMoney":410,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":35000,"order":18,"cost":{"virtualMoney":450,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":36000,"order":19,"cost":{"virtualMoney":500,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":38000,"order":20,"cost":{"virtualMoney":550,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":42000,"order":21,"cost":{"virtualMoney":610,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":42000,"order":22,"cost":{"virtualMoney":670,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":50000,"order":23,"cost":{"virtualMoney":740,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":50000,"order":24,"cost":{"virtualMoney":820,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":50000,"order":25,"cost":{"virtualMoney":910,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":55000,"order":26,"cost":{"virtualMoney":1000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":55000,"order":27,"cost":{"virtualMoney":1110,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":55000,"order":28,"cost":{"virtualMoney":1230,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":55000,"order":29,"cost":{"virtualMoney":1360,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":55000,"order":30,"cost":{"virtualMoney":1500,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":60000,"order":31,"cost":{"virtualMoney":1660,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":60000,"order":32,"cost":{"virtualMoney":1830,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":60000,"order":33,"cost":{"virtualMoney":2030,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":60000,"order":34,"cost":{"virtualMoney":2240,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":60000,"order":35,"cost":{"virtualMoney":2480,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":65000,"order":36,"cost":{"virtualMoney":2740,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":65000,"order":37,"cost":{"virtualMoney":3030,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":65000,"order":38,"cost":{"virtualMoney":3350,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":65000,"order":39,"cost":{"virtualMoney":3700,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":65000,"order":40,"cost":{"virtualMoney":4090,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":70000,"order":41,"cost":{"virtualMoney":4520,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":70000,"order":42,"cost":{"virtualMoney":5000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":70000,"order":43,"cost":{"virtualMoney":5520,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":70000,"order":44,"cost":{"virtualMoney":6100,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":80000,"order":45,"cost":{"virtualMoney":6750,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":90000,"order":46,"cost":{"virtualMoney":7460,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":100000,"order":47,"cost":{"virtualMoney":8240,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":105000,"order":48,"cost":{"virtualMoney":9110,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":105000,"order":49,"cost":{"virtualMoney":9400,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":110000,"order":50,"cost":{"virtualMoney":10300,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":120000,"order":51,"cost":{"virtualMoney":10600,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":120000,"order":52,"cost":{"virtualMoney":11700,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":120000,"order":53,"cost":{"virtualMoney":13000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":120000,"order":54,"cost":{"virtualMoney":14300,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":130000,"order":55,"cost":{"virtualMoney":15900,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":130000,"order":56,"cost":{"virtualMoney":16200,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":135000,"order":57,"cost":{"virtualMoney":17900,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":135000,"order":58,"cost":{"virtualMoney":19800,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":140000,"order":59,"cost":{"virtualMoney":21900,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":140000,"order":60,"cost":{"virtualMoney":24200,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":150000,"order":61,"cost":{"virtualMoney":24500,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":160000,"order":62,"cost":{"virtualMoney":27100,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":170000,"order":63,"cost":{"virtualMoney":29900,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":180000,"order":64,"cost":{"virtualMoney":33100,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":200000,"order":65,"cost":{"virtualMoney":36500,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":200000,"order":66,"cost":{"virtualMoney":36700,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":200000,"order":67,"cost":{"virtualMoney":40600,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":200000,"order":68,"cost":{"virtualMoney":44800,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":290000,"order":69,"cost":{"virtualMoney":49600,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":290000,"order":70,"cost":{"virtualMoney":54800,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":295000,"order":71,"cost":{"virtualMoney":54500,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":295000,"order":72,"cost":{"virtualMoney":60200,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":300000,"order":73,"cost":{"virtualMoney":66600,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":300000,"order":74,"cost":{"virtualMoney":73600,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":350000,"order":75,"cost":{"virtualMoney":77700,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":350000,"order":76,"cost":{"virtualMoney":85900,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":350000,"order":77,"cost":{"virtualMoney":92100,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":350000,"order":78,"cost":{"virtualMoney":98800,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":470000,"order":79,"cost":{"virtualMoney":102500,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":470000,"order":80,"cost":{"virtualMoney":106900,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":475000,"order":81,"cost":{"virtualMoney":109900,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":475000,"order":82,"cost":{"virtualMoney":113900,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":485000,"order":83,"cost":{"virtualMoney":117700,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":485000,"order":84,"cost":{"virtualMoney":121400,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":495000,"order":85,"cost":{"virtualMoney":125900,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":495000,"order":86,"cost":{"virtualMoney":128900,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":510000,"order":87,"cost":{"virtualMoney":134000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":510000,"order":88,"cost":{"virtualMoney":138200,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":520000,"order":89,"cost":{"virtualMoney":143000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":520000,"order":90,"cost":{"virtualMoney":147900,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":520000,"order":91,"cost":{"virtualMoney":154100,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":560000,"order":92,"cost":{"virtualMoney":159200,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":560000,"order":93,"cost":{"virtualMoney":165000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":560000,"order":94,"cost":{"virtualMoney":171500,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":680000,"order":95,"cost":{"virtualMoney":179000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":680000,"order":96,"cost":{"virtualMoney":187800,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":690000,"order":97,"cost":{"virtualMoney":199000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":690000,"order":98,"cost":{"virtualMoney":211200,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":700000,"order":99,"cost":{"virtualMoney":229000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":700000,"order":100,"cost":{"virtualMoney":240000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":750000,"order":101,"cost":{"virtualMoney":250000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":750000,"order":102,"cost":{"virtualMoney":250000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":800000,"order":103,"cost":{"virtualMoney":250000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":800000,"order":104,"cost":{"virtualMoney":250000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":830000,"order":105,"cost":{"virtualMoney":250000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":830000,"order":106,"cost":{"virtualMoney":250000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":865000,"order":107,"cost":{"virtualMoney":250000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":865000,"order":108,"cost":{"virtualMoney":250000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":900000,"order":109,"cost":{"virtualMoney":250000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0},{"vitality":900000,"order":110,"cost":{"virtualMoney":250000,"hardMoney":0,"energy":0,"lowTool":0,"highTool":0},"price":0}]
//replace vitalityPatchList from worldDef

//sort patchlist array ascending by attribute "order"
vitalityPatchList.sort(function(a,b){
	if(a.order< b.order) return -1;
	if(a.order> b.order) return 1;
	return 0;
});

var maxPatches=vitalityPatchList.length;

//button click-handler
$(function(){
    $("#btnCalc").click(function(){
		//get Values, numbers only
		var numPatches=parseInt($('#numPatches').val());
		var buyPatches=parseInt($('#buyPatches').val());
		var sellPatches=parseInt($('#sellPatches').val());
		
		if (numPatches>maxPatches) numPatches=maxPatches
		if (sellPatches>numPatches) 
			sellPatches=numPatches;
		if (numPatches-sellPatches+buyPatches>maxPatches) 
			buyPatches=maxPatches-(numPatches-sellPatches);
		
		$('#numPatches').val(numPatches);
		$('#buyPatches').val(buyPatches);
		$('#sellPatches').val(sellPatches);
		
		var out='<p>';
		var sumBuy=0;
		var sumSell=0;
		
		for (pi=numPatches; pi>numPatches-sellPatches; pi--)
			sumSell=sumSell+(vitalityPatchList[pi-1].cost.virtualMoney/2);
			
		out+="#1: You sell "+sellPatches+" patch(es) for ";
		out+=fmtNumber(sumSell)+"SD<br>";
			
		for (pi=numPatches-sellPatches+1; pi<=numPatches-sellPatches+buyPatches; pi++)
			sumBuy=sumBuy+(vitalityPatchList[pi-1].cost.virtualMoney);

		out+="#2: You buy "+buyPatches+" patch(es) for ";
		out+=fmtNumber(sumBuy)+"SD<br>";
		
		out+="Net costs: "+fmtNumber(sumBuy-sumSell)+"SD<br>";

		out+="</p>"

        $('#divResult').html(out);
    });
});

function fmtNumber(value) {
  return String(value).replace(/\d(?=(\d{3})+$)/g, '$&,');
}