// Modified from [[w:c:dev:MediaWiki:ThemeToggler.js]]

$(function() {
	if (mw.config.get('skin') !== 'fandomdesktop' || $('.caburum-theme-switcher').length) return;

	var urlTheme = mw.util.getParamValue('usetheme');
	if (['light', 'dark'].includes(urlTheme)) {
		setTheme(urlTheme);
	}

	function setTheme(newTheme) {
		// Implementation by [[User:Pcj]] from ThemeSwitcher
		$.when($.get(mw.util.wikiScript('wikia') + '?controller=ThemeApi&method=themeVariables&variant=' + newTheme + '&cb=' + (new Date().getTime())), $.get(mw.util.wikiScript('load') + '?modules=ext.fandom.DesignSystem.GlobalNavigation.brand.' + newTheme + '.css%7Cext.fandom.DesignSystem.brand.' + newTheme + '.css&only=styles'))
		.done(function(wikiTheme, brandTheme) {
			var css = wikiTheme[0] + brandTheme[0];
			var $s = $('#ThemeSwitcher')[0] || $('<style>').attr('id', 'ThemeSwitcher').appendTo('body');
			$($s).text(css);
			$('body').removeClass('theme-fandomdesktop-light theme-fandomdesktop-dark').addClass('theme-fandomdesktop-' + newTheme);
		});
	}

	var sun = '<svg id="wds-icons-sun-small" class="wds-icon wds-icon-small" viewBox="0 0 18 18"><path d="M9.00001 14C8.0111 14 7.04441 13.7067 6.22216 13.1573C5.39991 12.6079 4.75905 11.827 4.38061 10.9134C4.00217 9.99975 3.90316 8.99442 4.09608 8.02452C4.28901 7.05461 4.76521 6.1637 5.46448 5.46443C6.16374 4.76517 7.05465 4.28897 8.02456 4.09604C8.99446 3.90311 9.9998 4.00213 10.9134 4.38057C11.8271 4.75901 12.608 5.39987 13.1574 6.22212C13.7068 7.04436 14 8.01106 14 8.99997C14 9.65658 13.8707 10.3068 13.6194 10.9134C13.3681 11.52 12.9998 12.0712 12.5355 12.5355C12.0713 12.9998 11.5201 13.3681 10.9134 13.6194C10.3068 13.8706 9.65662 14 9.00001 14V14ZM9.00001 5.99997C8.40667 5.99997 7.82665 6.17591 7.3333 6.50556C6.83995 6.8352 6.45543 7.30374 6.22837 7.85192C6.00131 8.4001 5.9419 9.00329 6.05765 9.58524C6.17341 10.1672 6.45913 10.7017 6.87869 11.1213C7.29825 11.5408 7.8328 11.8266 8.41474 11.9423C8.99668 12.0581 9.59988 11.9987 10.1481 11.7716C10.6962 11.5445 11.1648 11.16 11.4944 10.6667C11.8241 10.1733 12 9.59331 12 8.99997C12 8.20432 11.6839 7.44126 11.1213 6.87865C10.5587 6.31604 9.79566 5.99997 9.00001 5.99997ZM9.20001 1.99997C9.26266 1.98902 9.32332 1.9688 9.38001 1.93997L9.56001 1.84997L9.71001 1.72997C9.89748 1.53332 10.0014 1.27166 10 0.999967C9.99843 0.86929 9.97125 0.740189 9.92001 0.619967C9.87242 0.497216 9.80105 0.385071 9.71001 0.289967L9.56001 0.169967L9.38001 0.0799671C9.3245 0.0441716 9.26378 0.0171853 9.20001 -3.29185e-05C9.00501 -0.0380944 8.80309 -0.0172063 8.62001 0.0599671C8.49883 0.110609 8.38721 0.181636 8.29001 0.269967C8.19897 0.365071 8.1276 0.477216 8.08001 0.599967C8.02614 0.726387 7.99891 0.862553 8.00001 0.999967C8.00159 1.13064 8.02877 1.25974 8.08001 1.37997C8.13065 1.50115 8.20168 1.61277 8.29001 1.70997C8.48164 1.8927 8.73524 1.99628 9.00001 1.99997H9.20001ZM9.71001 17.73C9.79834 17.6328 9.86937 17.5212 9.92001 17.4C9.97388 17.2735 10.0011 17.1374 10 17C10.0012 16.8013 9.94314 16.6069 9.83334 16.4414C9.72354 16.2758 9.56694 16.1468 9.38349 16.0706C9.20005 15.9944 8.99808 15.9746 8.80333 16.0137C8.60858 16.0528 8.42988 16.1489 8.29001 16.29C8.10728 16.4816 8.00369 16.7352 8.00001 17C8.00159 17.1306 8.02877 17.2597 8.08001 17.38C8.13065 17.5012 8.20168 17.6128 8.29001 17.71C8.38297 17.8037 8.49357 17.8781 8.61543 17.9289C8.73729 17.9796 8.868 18.0058 9.00001 18.0058C9.13202 18.0058 9.26273 17.9796 9.38459 17.9289C9.50645 17.8781 9.61705 17.8037 9.71001 17.71V17.73ZM17.71 9.72997C17.753 9.68245 17.7931 9.63235 17.83 9.57997C17.8679 9.52422 17.8981 9.46369 17.92 9.39997C17.9578 9.3383 17.9848 9.27067 18 9.19997C18.0045 9.13337 18.0045 9.06656 18 8.99997C18 8.73475 17.8947 8.4804 17.7071 8.29286C17.5196 8.10532 17.2652 7.99997 17 7.99997C16.7348 7.99997 16.4804 8.10532 16.2929 8.29286C16.1054 8.4804 16 8.73475 16 8.99997C15.9956 9.06656 15.9956 9.13337 16 9.19997C16.011 9.26261 16.0312 9.32328 16.06 9.37997C16.0819 9.44369 16.1122 9.50422 16.15 9.55997L16.27 9.70997C16.363 9.8037 16.4736 9.87809 16.5954 9.92886C16.7173 9.97963 16.848 10.0058 16.98 10.0058C17.112 10.0058 17.2427 9.97963 17.3646 9.92886C17.4864 9.87809 17.597 9.8037 17.69 9.70997L17.71 9.72997ZM1.71001 9.72997L1.83001 9.57997C1.86786 9.52422 1.89812 9.46369 1.92001 9.39997C1.95779 9.3383 1.98484 9.27067 2.00001 9.19997C2.00446 9.13337 2.00446 9.06656 2.00001 8.99997C2.00339 8.86879 1.97599 8.73865 1.92001 8.61997C1.87242 8.49722 1.80105 8.38507 1.71001 8.28997C1.61705 8.19624 1.50645 8.12184 1.38459 8.07108C1.26273 8.02031 1.13202 7.99417 1.00001 7.99417C0.867999 7.99417 0.737293 8.02031 0.615434 8.07108C0.493575 8.12184 0.382974 8.19624 0.290011 8.28997C0.19897 8.38507 0.127605 8.49722 0.0800106 8.61997C0.0287697 8.74019 0.00159062 8.86929 1.06292e-05 8.99997C-0.00443876 9.06656 -0.00443876 9.13337 1.06292e-05 9.19997C0.0109562 9.26261 0.0311784 9.32328 0.0600106 9.37997C0.0818989 9.44369 0.112164 9.50422 0.150011 9.55997L0.270011 9.70997C0.365114 9.80101 0.477259 9.87237 0.600011 9.91997C0.724745 9.97909 0.862129 10.0066 1.00001 9.99997C1.26478 9.99628 1.51838 9.8927 1.71001 9.70997V9.72997ZM14.85 4.31997L15 4.26997C15.0598 4.24232 15.1168 4.20882 15.17 4.16997C15.2282 4.1415 15.2795 4.10053 15.32 4.04997L15.45 3.89997C15.4839 3.84543 15.5139 3.78863 15.54 3.72997C15.5645 3.66815 15.5846 3.60465 15.6 3.53997C15.6049 3.47339 15.6049 3.40654 15.6 3.33997C15.6128 3.22632 15.6061 3.11132 15.58 2.99997C15.5317 2.87809 15.4565 2.7687 15.36 2.67997C15.3171 2.6291 15.2665 2.58524 15.21 2.54997C15.1462 2.49729 15.0756 2.45356 15 2.41997L14.81 2.35997C14.615 2.32191 14.4131 2.34279 14.23 2.41997C14.1081 2.46825 13.9987 2.54346 13.91 2.63997C13.7253 2.82623 13.6211 3.07763 13.62 3.33997C13.6102 3.40627 13.6102 3.47366 13.62 3.53997C13.632 3.60445 13.6487 3.66795 13.67 3.72997L13.77 3.89997C13.8038 3.95466 13.8441 4.00503 13.89 4.04997C13.9813 4.14351 14.09 4.21825 14.21 4.26997C14.3345 4.31738 14.4668 4.34112 14.6 4.33997C14.6838 4.3504 14.7689 4.3436 14.85 4.31997V4.31997ZM4.05001 15.32C4.23475 15.1337 4.33891 14.8823 4.34001 14.62C4.34116 14.4867 4.31742 14.3545 4.27001 14.23C4.20943 14.142 4.13515 14.0644 4.05001 14C3.86265 13.8137 3.6092 13.7092 3.34501 13.7092C3.08083 13.7092 2.82737 13.8137 2.64001 14C2.5435 14.0887 2.4683 14.1981 2.42001 14.32C2.36963 14.444 2.34251 14.5762 2.34001 14.71C2.34159 14.8406 2.36877 14.9697 2.42001 15.09C2.4683 15.2118 2.5435 15.3212 2.64001 15.41C2.82737 15.5962 3.08083 15.7008 3.34501 15.7008C3.6092 15.7008 3.86265 15.5962 4.05001 15.41V15.32ZM15.36 15.32C15.5484 15.1353 15.6563 14.8837 15.66 14.62C15.6575 14.4862 15.6304 14.354 15.58 14.23C15.5317 14.1081 15.4565 13.9987 15.36 13.91C15.164 13.7502 14.9147 13.6707 14.6623 13.6874C14.41 13.7041 14.1733 13.8158 14 14C13.9065 14.0912 13.8317 14.1999 13.78 14.32C13.7326 14.4445 13.7089 14.5767 13.71 14.71C13.7084 14.84 13.7322 14.9691 13.78 15.09C13.8317 15.21 13.9065 15.3187 14 15.41C14.1874 15.5962 14.4408 15.7008 14.705 15.7008C14.9692 15.7008 15.2226 15.5962 15.41 15.41L15.36 15.32ZM4.05001 4.04997C4.09596 4.00503 4.13626 3.95466 4.17001 3.89997L4.27001 3.72997C4.29134 3.66795 4.30805 3.60445 4.32001 3.53997C4.32987 3.47366 4.32987 3.40627 4.32001 3.33997C4.31891 3.07763 4.21475 2.82623 4.03001 2.63997C3.94128 2.54346 3.83189 2.46825 3.71001 2.41997C3.58803 2.36908 3.45718 2.34288 3.32501 2.34288C3.19284 2.34288 3.06199 2.36908 2.94001 2.41997C2.81813 2.46825 2.70874 2.54346 2.62001 2.63997C2.52549 2.74223 2.45691 2.86569 2.42001 2.99997C2.36877 3.12019 2.34159 3.24929 2.34001 3.37997C2.3351 3.44654 2.3351 3.51339 2.34001 3.57997L2.40001 3.76997C2.42608 3.82863 2.45615 3.88543 2.49001 3.93997L2.62001 4.08997C2.73249 4.17622 2.86202 4.23758 3.00001 4.26997C3.18307 4.3453 3.38437 4.36461 3.57841 4.32544C3.77245 4.28628 3.9505 4.1904 4.09001 4.04997H4.05001Z"></path></svg>',
	moon = '<svg id="wds-icons-moon-small" class="wds-icon wds-icon-small" viewBox="0 0 18 18"><path d="M9 17C6.97016 16.9786 5.02436 16.1863 3.55687 14.7837C2.08938 13.3812 1.20995 11.4732 1.09679 9.44639C0.983621 7.41959 1.64518 5.42556 2.94741 3.86835C4.24965 2.31113 6.09516 1.3072 8.11 1.05996C8.30858 1.03515 8.51004 1.07049 8.68832 1.16141C8.86659 1.25233 9.01349 1.39465 9.11 1.56996C9.204 1.74498 9.24374 1.94403 9.22414 2.14172C9.20455 2.33942 9.12652 2.5268 9 2.67996C8.3519 3.47677 7.99868 4.47286 8 5.49996C8.00265 6.69263 8.4776 7.83568 9.32094 8.67903C10.1643 9.52237 11.3073 9.99732 12.5 9.99996C13.5271 10.0013 14.5232 9.64806 15.32 8.99996C15.4742 8.87503 15.6621 8.7988 15.8598 8.78099C16.0574 8.76319 16.2559 8.8046 16.43 8.89996C16.6053 8.99648 16.7476 9.14337 16.8386 9.32165C16.9295 9.49993 16.9648 9.70138 16.94 9.89996C16.719 11.8518 15.7877 13.6541 14.3234 14.9635C12.8591 16.2728 10.9643 16.9977 9 17V17ZM6.27 3.64996C5.42973 4.08218 4.70343 4.70674 4.15023 5.47279C3.59703 6.23884 3.23257 7.12471 3.08655 8.05828C2.94053 8.99184 3.01706 9.94669 3.30992 10.8451C3.60278 11.7435 4.10368 12.56 4.77183 13.2281C5.43999 13.8963 6.2565 14.3972 7.15489 14.69C8.05328 14.9829 9.00813 15.0594 9.94169 14.9134C10.8753 14.7674 11.7611 14.4029 12.5272 13.8497C13.2932 13.2965 13.9178 12.5702 14.35 11.73C13.7498 11.9098 13.1265 12.0007 12.5 12C10.7769 11.9973 9.12515 11.3116 7.90673 10.0932C6.68832 8.87482 6.00265 7.22306 6 5.49996C5.99925 4.87342 6.09021 4.25015 6.27 3.64996V3.64996Z"></path></svg>';

	$.when(mw.loader.using(['mediawiki.api', 'mediawiki.jqueryMsg']), mw.hook('wikipage.content').add(function() {return true}))
		.then(function() {
			return new mw.Api().loadMessagesIfMissing(['fd-community-header-light-theme', 'fd-community-header-dark-theme']);
		})
		.then(function() {
			var isLight = $('body').hasClass('theme-fandomdesktop-light');
			$('.wiki-tools .wds-dropdown').before('<a class="wds-button wds-is-secondary caburum-theme-switcher" title="' + mw.msg('fd-community-header-' + (isLight ? 'dark' : 'light') + '-theme') + '" />');
			$('.caburum-theme-switcher').append(isLight ? moon : sun);

			$('.caburum-theme-switcher').click(function() {
				var theme = $('body').hasClass('theme-fandomdesktop-light') ? 'light' : 'dark';
				var newTheme = theme === 'light' ? 'dark' : 'light';
				setTheme(newTheme);
				$('.caburum-theme-switcher').empty();
				$('.caburum-theme-switcher').append(newTheme === 'light' ? moon : sun);
				$('.caburum-theme-switcher').attr('title', mw.msg('fd-community-header-' + theme + '-theme'));
			});
		});
});